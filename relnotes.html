<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"
      integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <h1>Release Notes Loader</h1>
    <label for="owner">GitHub Repo Path as "owner/repo":</label>
    <input id="repo-path" />

    <br />
    <label for="markdown">Render Markdown:</label>
    <input id="markdown" type="checkbox" checked />
    <br />
    <button id="start">Start</button>
    <button id="select-all">Select content</button>

    <div id="rel-notes"></div>
    <script>
      const converter = new showdown.Converter();

      function collectReleaseNotes(repo, renderMarkdown, page) {
        const div = document.getElementById('rel-notes');
        fetch(`https://api.github.com/repos/${repo}/releases?page=${page}`)
          .then(response => response.json())
          .then(releases => {
            if (releases.length) {
              // div.innerHTML += `<h1>Page ${page}</h1>`;
              releases.forEach(release => {
                div.innerHTML += '<hr>';
                div.innerHTML += `<h2><a href="${release.html_url}">${release.tag_name}</a></h2>`;
                const html = renderMarkdown
                  ? converter.makeHtml(release.body)
                  : `<pre>${release.body}</pre>`;
                div.innerHTML += html;
              });

              setTimeout(() => {
                collectReleaseNotes(repo, renderMarkdown, page + 1);
              }, 200);
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }

      function start() {
        document.getElementById('rel-notes').innerHTML = '';
        const repoPath = document.getElementById('repo-path').value;
        const renderMarkdown = document.getElementById('markdown').checked;
        collectReleaseNotes(repoPath, renderMarkdown, 1);
      }

      document.getElementById('select-all').addEventListener('click', () => {
        const relNotesDiv = document.getElementById('rel-notes');
        const range = document.createRange();
        range.selectNodeContents(relNotesDiv);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
      });

      document.getElementById('repo-path').addEventListener('keyup', event => {
        if (event.key === 'Enter') {
          start();
        }
      });

      document.getElementById('start').addEventListener('click', start);
    </script>
  </body>
</html>
